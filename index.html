<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mobile Theremin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Helvetica', sans-serif;
      margin: 0;
      padding: 0;
      background: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
      user-select: none;
    }

    #controls {
      position: fixed;
      bottom: 20px;
      width: 100%;
      padding: 0 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    #powerBtn {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: #ff5757;
      color: white;
      border: none;
      font-size: 18px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }

    #waveButtons {
      display: flex;
      width: 100%;
      justify-content: space-between;
      gap: 5px;
    }

    .waveBtn {
      flex: 1;
      height: 50px;
      background: #4a90e2;
      color: white;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    #display {
      text-align: center;
      font-size: 24px;
      margin-bottom: 150px;
    }

    #frequency, #volume {
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div id="display">
    <div id="frequency">Frequency: — Hz</div>
    <div id="volume">Volume: — %</div>
  </div>

  <div id="controls">
    <button id="powerBtn">Start</button>
    <div id="waveButtons" style="display: none;">
      <button class="waveBtn" data-wave="sine">Sine</button>
      <button class="waveBtn" data-wave="sawtooth">Saw</button>
      <button class="waveBtn" data-wave="square">Square</button>
      <button class="waveBtn" data-wave="triangle">Triangle</button>
    </div>
  </div>

  <script>
    let audioCtx, oscillator, gainNode;
    let isPlaying = false;
    const powerBtn = document.getElementById('powerBtn');
    const waveButtons = document.getElementById('waveButtons');
    const freqDisplay = document.getElementById('frequency');
    const volDisplay = document.getElementById('volume');

    let currentWave = 'sine';

    powerBtn.onclick = () => {
      if (!isPlaying) startTheremin();
      else stopTheremin();
    };

    document.querySelectorAll('.waveBtn').forEach(btn => {
      btn.onclick = () => {
        currentWave = btn.getAttribute('data-wave');
        if (oscillator) oscillator.type = currentWave;
      };
    });

    function startTheremin() {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      oscillator = audioCtx.createOscillator();
      gainNode = audioCtx.createGain();

      oscillator.type = currentWave;
      oscillator.frequency.value = 440;
      gainNode.gain.value = 0.5;

      oscillator.connect(gainNode).connect(audioCtx.destination);
      oscillator.start();

      isPlaying = true;
      powerBtn.textContent = 'Stop';
      powerBtn.style.background = '#4caf50';
      waveButtons.style.display = 'flex';

      window.addEventListener('deviceorientation', handleOrientation);
    }

    function stopTheremin() {
      oscillator.stop();
      oscillator.disconnect();
      gainNode.disconnect();
      oscillator = null;
      isPlaying = false;
      powerBtn.textContent = 'Start';
      powerBtn.style.background = '#ff5757';
      waveButtons.style.display = 'none';
      freqDisplay.textContent = 'Frequency: — Hz';
      volDisplay.textContent = 'Volume: — %';
      window.removeEventListener('deviceorientation', handleOrientation);
    }

    function handleOrientation(event) {
      if (!oscillator || !gainNode) return;

      const beta = event.beta || 0;  // Front-back tilt for frequency
      const gamma = event.gamma || 0; // Left-right tilt for volume

      // Frequency: 100Hz - 1200Hz
      let freq = 440 + beta * 10;
      freq = Math.min(Math.max(freq, 100), 1200);

      // Volume: 0% - 100%
      let volume = 0.5 + (gamma / 180);
      volume = Math.min(Math.max(volume, 0), 1);

      oscillator.frequency.value = freq;
      gainNode.gain.value = volume;

      freqDisplay.textContent = `Frequency: ${freq.toFixed(1)} Hz`;
      volDisplay.textContent = `Volume: ${(volume * 100).toFixed(0)} %`;
    }
  </script>
</body>
</html>
